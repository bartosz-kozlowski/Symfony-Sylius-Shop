<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<turbo-frame id="productListFrame" class="h-100">
    <div class="d-flex flex-column h-100" style="min-height: 0;">
        <div class="flex-grow-1 overflow-auto">
            <ul class="list-group list-group-flush">
                {% for product in products %}
                    {% set image = product.images|first %}
                    {% set path = image.path is not null
                        ? image.path|imagine_filter('sylius_shop_product_small_thumbnail')
                        : asset('build/shop/images/200x200.png') %}

                    {% set variantsJson = product.variants
                    |map(v => {
                        id:      v.id,
                        code:    v.code,
                        color:   v.modelColor,
                        options: v.optionValues
                        |map(val => {
                            code:  val.option.code,
                            name: val.option.translation.name,
                            value: val.value
                        })
                    })
                    |json_encode
                    %}

                    <li class="list-group-item p-3 border-0 border-bottom hover-bg-light">
                        <div class="d-flex align-items-center justify-content-between">
                            <a href="#"
                               class="d-flex align-items-center text-reset text-decoration-none flex-grow-1 me-2"
                               data-model="{{ asset(product.model3dPath) }}"
                               data-product-id="{{ product.id }}"
                               data-product-name="{{ product.translation.name }}"
                               data-variant-id="{{ product.variants.first.code }}"
                               data-color="{{ product.variants.first.modelColor }}"
                               data-variants='{{ variantsJson|e('html_attr') }}'>
{#                                {{  dump(product.variants) }}#}
{#                                {{ dump(product.variants.first.modelColor) }}#}
{#                                {{ dump(variantsJson|raw) }}#}
                                <img src="{{ path }}" height="70" class="rounded-3 me-3 border" alt="">
                                <div class="fw-semibold small">{{ product.translation.name }}</div>
                            </a>
                            <button class="btn btn-outline-success btn-sm add-to-stack"
                                    title="Dodaj produkt"
                                    data-bs-toggle="tooltip"
                                    >
                                <i class="bi bi-plus-lg"></i>
                            </button>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>

        {% if products.pageCount > 1 %}
            <div class="border-top bg-white px-3 py-2 position-sticky bottom-0" style="z-index: 1;">
                <nav class="d-flex justify-content-center">
                    {{ knp_pagination_render(products, '_pagination_config.html.twig') }}
                </nav>
            </div>
        {% endif %}
    </div>
    <div class="modal fade" id="variantSelectModal" tabindex="-1" aria-labelledby="variantSelectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="variantSelectModalLabel">Wybierz wariant</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
                </div>
                <div class="modal-body">
                    <form id="variantForm">
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="confirmVariantBtn" type="button" class="btn btn-primary">Zmie≈Ñ wariant</button>
                </div>
            </div>
        </div>
    </div>
</turbo-frame>
